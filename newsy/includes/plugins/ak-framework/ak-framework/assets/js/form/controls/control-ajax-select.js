!function(s){"use strict";ak.form.controlConstructor.ajax_select=ak.form.Control.extend({ready:function(){var c,t=this,e=t.container.find("input"),i=e.data("callback"),r=e.data("callback-args")||{},a=e.data("selectize-value"),n=e.data("exculable"),o=parseInt(e.data("max-items"));(!o||""===o||o<2)&&(o=1),s(e).selectize({maxItems:o,plugins:["remove_button","drag_drop"],persist:!0,create:!1,hideSelected:!0,valueField:"value",labelField:"text",searchField:"text",render:{item:function(e,a){var t=e.text;return void 0===t?"<div><span>"+e.value+"</span></div>":"<div><span>"+t+"</span></div>"},option:function(e,a){var t=e.text;return"no-result"===e.value?'<div style="pointer-events: none; color: #aaa;"><span>'+a(t)+"</span></div>":void 0===t?"<div><span>"+e.value+"</span></div>":"<div><span>"+t+"</span></div>"}},load:function(a,n){var o=this;if(!a.length)return n();var l=[];s.each(o.items,function(e,a){l[a.toString().replace("-","")]=a}),c&&c.abort(),c=s.ajax({url:ak_framework_loc.ajax_url,type:"POST",dataType:"json",cache:!1,data:{action:"ak_admin_ajax",action_id:"control-select-callback",nonce:ak_framework_loc.nonce,callback:{function:i,args:{0:s.extend(r,{search:encodeURIComponent(a)})}}},error:function(){n()},success:function(e){var t=[];e.success&&s.each(e.result,function(e,a){null==l[e]&&t.push({value:e,text:a})}),0<t.length?n(t):n([{value:"no-result",text:'No Results for "'+a+'"'}]),o.open()}}).always(function(){c=null})},onInitialize:function(){var e,t,n,o=this;o.clearOptions(!0),a&&""!==a&&(c&&c.abort(),e="string"==typeof a?a.split(","):a,t="",n=[],(e="object"!=typeof e?[e]:e).forEach(function(e){var a;"-"===e.toString().substring(0,1)?(a=e.substring(1),n.push(a)):a=e,t+=""===t?a:","+a}),c=s.ajax({url:ak_framework_loc.ajax_url,type:"POST",dataType:"json",data:{action:"ak_admin_ajax",action_id:"control-select-callback",nonce:ak_framework_loc.nonce,callback:{function:i+"_by_values",args:t}},success:function(e){o.clear(!0),s.each(e.result,function(e,a){-1!==s.inArray(e,n)&&(e="-"+e),o.addOption({value:e,text:a}),o.addItem(e)})}}).always(function(){c=null}))},onItemAdd:function(e,a){"-"===e.substring(0,1)&&a.addClass("excluded"),n&&(0===a.find(".exclude-btn").length&&a.append('<a href="javascript:void(0)" class="exclude-btn" tabindex="-1" title="Toggle Exclude"></a>'),t.exculade(a,this))},onChange:function(e){t.setting.set(e)}})},exculade:function(t,n){s(t).on("click",".exclude-btn",function(e){e.preventDefault();var e=s(t).data("value"),a=s(t).find("span").text();s(t).toggleClass("excluded"),s(t).hasClass("excluded")&&"-"!==e.toString().substring(0,1)?(n.removeOption(e,!0),n.removeItem(e,!0),n.addOption({value:"-"+e,text:a}),n.addItem("-"+e)):(e=e.toString().substring(1),n.removeOption("-"+e,!0),n.removeItem("-"+e,!0),n.addOption({value:e,text:a}),n.addItem(e))})}})}(jQuery);