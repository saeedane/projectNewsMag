!function(c){"use strict";({$document:c(document),demo_id:!1,demo_group:!1,demo_clear:!0,$demo_steps:[],$current_demo_el:!1,$active_el:!1,$with_content:"yes",$current_action:{},$progress_min:10,init:function(){var t=this;t.$document.ready(function(){t.install(),t.uninstall()})},install:function(){var e=this;c(".ak-install-demo").on("click",function(t){t.preventDefault(),e.$active_el=this,e.$current_demo_el=c(e.$active_el).closest(".ak-install-demo-page-item"),e.demo_id=e.$current_demo_el.data("id"),e.demo_group=e.$current_demo_el.data("group"),e.demo_clear=e.$current_demo_el.data("clear"),swal({title:ak_install_demo_loc.install.title,text:ak_install_demo_loc.install.text,type:"warning",showCancelButton:!0,customClass:"install_popup",confirmButtonColor:"#DD6B55",confirmButtonText:ak_install_demo_loc.install.confirmButtonText,cancelButtonText:ak_install_demo_loc.install.cancelButtonText,closeOnConfirm:!0,closeOnCancel:!0,html:!0},function(t){t&&(e.$current_action="install",e.get_steps())}),0==c(".with_content").length&&(t='<div class="with_content" ><label for="with_content" ><input type="checkbox" id="with_content" checked><span>'+ak_install_demo_loc.with_content+"</span></label></div>",c(".sa-confirm-button-container").append(t)),c('input[type="checkbox"]').on("click",function(t){0==c(this).prop("checked")?(e.$with_content="no",c(this).prop("checked",!1)):(e.$with_content="yes",c(this).prop("checked",!0))})})},uninstall:function(){var e=this;c(".ak-uninstall-demo").on("click",function(t){t.preventDefault(),e.$active_el=this,e.$current_demo_el=c(e.$active_el).closest(".ak-install-demo-page-item"),e.demo_id=e.$current_demo_el.data("id"),e.demo_group=e.$current_demo_el.data("group"),e.demo_clear=e.$current_demo_el.data("clear"),swal({title:ak_install_demo_loc.uninstall.title,text:ak_install_demo_loc.uninstall.text,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:ak_install_demo_loc.uninstall.confirmButtonText,cancelButtonText:ak_install_demo_loc.uninstall.cancelButtonText,closeOnConfirm:!0,closeOnCancel:!0,html:!0},function(t){t&&(e.$current_action="uninstall",e.$with_content="yes",e.get_steps())})})},get_steps:function(){var e=this;e.ajax({import_action:"get_steps",import_status:e.$current_action,import_content:e.$with_content,import_id:e.demo_id,import_group:e.demo_group,import_clear:e.$current_demo_el.data("clear")},function(t){t&&void 0!==t.success&&t.success?(e.$demo_steps=t.result.steps,swal({title:"install"===e.$current_action?ak_install_demo_loc.installing:ak_install_demo_loc.uninstalling,text:'<div class="ak-progress-bar"><div class="ak-progress"></div></div><div class="ak-demo-progress-detail"></div><p style="color:red">'+ak_install_demo_loc.donotclose+"</p>",html:!0,timer:2e6,showConfirmButton:!1}),e.proceed_steps(0)):e.show_error(0)})},proceed_steps:function(n){var l=this,t=l.$demo_steps[n],a=t.import_type,i=t.import_group,s=l._helper_len(l.$demo_steps)-1;l.ajax(t,function(t,e,o){var o=o.getResponseHeader("content-type")||"";o&&-1<o.indexOf("html")&&(o=t.split("{"),t=JSON.parse("{"+o[1])),t&&void 0!==t.success&&t.success?(c(".ak-demo-progress-detail").text(a+": "+n+"/"+s),c(".ak-progress").css("width",Math.max(10,Math.floor(100/s*n))+"%"),s<=n?l.show_success():(l.demo_clear&&c(".ak-install-demo-page-item[data-group="+i+"]").removeClass("installed"),c('[data-demo-id="'+l.demo_id+'"]').removeClass("installed"),l.proceed_steps(n+1))):(console.log("proceed_steps:fail: "),l.show_error(t.result))})},ajax:function(e,t){var o=this;c.ajax({url:ak_framework_loc.ajax_url,type:"POST",data:c.extend({action:"ak_admin_ajax",action_id:"product-panel",module_id:"install-demo",nonce:ak_framework_loc.nonce,import_group:o.demo_group},e)}).done(t).fail(function(t){console.log("ajax:fail: "),console.log("payload",e),console.log("response",t),o.show_error(t)})},show_success:function(){var t,e=this,e=("install"===e.$current_action?(t="install_success",e.$current_demo_el.addClass("installed")):"uninstall"===e.$current_action&&(t="uninstall_success",e.$current_demo_el.removeClass("installed")),ak_install_demo_loc[t]);swal({title:e.title,text:e.text,type:"success",confirmButtonText:e.confirmButtonText,closeOnConfirm:!0,showCancelButton:!1,html:!0})},show_error:function(t){var e,o=this,n="",l=!1;if(t&&(e=t.code||t.readyState||"",t=t.message||t.responseText||"",n='<textarea class="error-textarea">'+ak_install_demo_loc.display_error+" "+e+" - "+t.replace(/<[^>]*>?/gm,"")+"</textarea>"),"force-failed"===o.$current_action)return!1;e="uninstall"===o.$current_action?"uninstall_error":"install_error";l=!0,t=ak_install_demo_loc[e];swal({title:t.title,text:t.text+n,type:"error",confirmButtonText:t.confirmButtonText,closeOnConfirm:!0,showCancelButton:!1,html:!0},function(t){}),l&&(o.$current_action="force-failed",o.ajax({import_action:"force_uninstall",import_id:o.demo_id,import_group:o.demo_group},function(t){return!1}))},_helper_len:function(t){var o=0;return c.each(t,function(t,e){o++}),o}}).init()}(jQuery);