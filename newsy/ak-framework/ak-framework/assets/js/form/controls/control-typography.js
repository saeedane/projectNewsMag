!function(r){"use strict";ak.form.controlConstructor.typography=ak.form.controlConstructor.mix_fields.extend({$document:r(document),$but_el:!1,$font_element_cache:!1,search_array:[],$instance_response:void 0,ready:function(){var e=this;this.initMixFields(),this.$but_el=e.container.find(".ak-font-select-manager"),this.$but_el.on("click",function(t){t.preventDefault(),swal({title:"Fonts",text:e.get_font_elements(),customClass:"font_popup",confirmButtonColor:"#DD6B55",showConfirmButton:!1,showCancelButton:!0,allowOutsideClick:!0,html:!0})})},setTypographyValue:function(t){var e,a,n,o=this,s=!1,i=!1;""===t.family?(t.subset="",t.variant=""):void 0!==o.$instance_response&&(s=(e=o.$instance_response[t.family]).variants,i=e.subsets),o.container.find(".ak-font-select-manager input").val(t.family),ak.form.Controls[o.id+"[family]"].setValue(t.family),!1!==s&&((a=o.container.find(".ak-section-typography-variants select")).empty(),r.each(s,function(t,e){a.append('<option value="'+t+'">'+e+"</option>")}),void 0===s[t.variant]&&(t.variant=void 0!==s[400]||void 0!==s.regular?"400":a.find("option:first").val()),a.val(t.variant),ak.form.Controls[o.id+"[variant]"].setValue(t.variant)),!1!==i&&((n=o.container.find(".ak-section-typography-subsets select")).empty(),r.each(i,function(t,e){n.append('<option value="'+t+'">'+e+"</option>")}),void 0===i[t.subset]&&(t.subset=void 0!==i.latin?"latin":n.find("option:first").val()),n.val(t.subset),ak.form.Controls[o.id+"[subset]"].setValue(t.subset)),this.setValue(t)},init_search:function(){var o=this;r(".search-fonts").on("keyup paste",ak_debounce(function(t){var e,a=r(this).val(),n=".ak-typography-option";""!==a&&null!==a?0<(e=(a=new Fuse(o.search_array,{tokenize:!0,matchAllTokens:!0,threshold:.3,keys:["name"]}).search(a)).length)?(r(n).hide(),r(".font-search-wrap").html(e+" Results Found"),r.each(a,function(t,e){r(n+'[data-value="'+e.name+'"]').show()})):(r(n).hide(),r(".font-search-wrap").html("No Result")):(r(n).show(),r(".font-search-wrap").html(""))},100))},font_selector:function(){var e=this;r(".ak-typography-option").on("click",function(t){t.preventDefault(),e.container.find(".ak-font-select-manager input").val(r(this).data("value")),e.setTypographyValue(e.getValue()),swal({title:"",timer:1})})},get_font_elements:function(){var t="",t=(t=(t=(t=(t=(t=(t=(t=(t+='<div class="ak-font-select-fonts">')+'<button class="cancel modal-close" tabindex="2"><i class="fa fa-window-close"></i></button>'+'<input type="text" class="search-fonts form-control" tabindex="3"  placeholder="Search something">')+'<ul class="font-search-wrap font-options-list ak-clearfix"></ul>'+'<div class="font-item-list font-options-list ak-clearfix">')+'<div data-value="" class="ak-typography-option ">'+'<div class="font-info">')+'<span class="font-name">Default</span>'+'<span class="font-type">Default element from previus class.</span>')+"</div>"+'<div class="font-preview">')+ak_font_manager_loc.preview_text+"</div>")+"</div>"+'<div class="ak-font-load"></div>')+"</div>"+"</div>";return this.get_ajax_fonts(),t},get_ajax_fonts:function(){var e=this;void 0===e.$instance_response?r.ajax({url:ak_framework_loc.ajax_url,type:"POST",dataType:"json",data:{action:"ak_admin_ajax",action_id:"ajax-font-manager",nonce:ak_framework_loc.nonce},success:function(t){e.$instance_response=t.result,e.init_response(t.result)}}):setTimeout(function(){e.init_response(e.$instance_response)},300)},init_response:function(t){var n=this,o="";r.each(t,function(t,e){var a=e.family||t;o=(o=(o=(o=(o+='<div data-value="'+t+'" class="ak-typography-option ">')+'<div class="font-info"><span class="font-name">'+t+"</span>")+'<span class="font-type">'+e.type.replace("-"," ").toUpperCase()+"</span>")+'</div><div class="font-preview" style="font-family:\''+a+"'; font-size: 24px;\">")+ak_font_manager_loc.preview_text+"</div></div>",n.search_array.push({name:t})}),r(".ak-font-load").html(o),n.font_selector(),n.init_search(),n.init_preview_fonts(".font-item-list")},init_preview_fonts:function(t){var a=this;"function"==typeof Impression&&new Impression({tolerance:0,debounce:10,container:document.querySelector(t)}).on("begin",".ak-typography-option",function(t){var e=r(t).data("value");""===e||r(t).hasClass("initted")||(a.preview_fonts(a.$instance_response[e].type,e),r(t).addClass("initted"))})},preview_fonts:function(t,e){switch(t){case"google-font":WebFont.load({google:{families:[e],text:ak_font_manager_loc.preview_text},timeout:2e3,classes:!1});break;case"custom-font":WebFont.load({custom:{families:[e],text:ak_font_manager_loc.preview_text},timeout:2e3,classes:!1});break;default:return!1}return!0}})}(jQuery);